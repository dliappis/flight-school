---

groups:
  - name: elasticsearch
    jobs:
      - elasticsearch-intake
      - elasticsearch-os-compatibility
      - elasticsearch-periodic

  - name: logstash
    jobs: []

  - name: kibana
    jobs: []

  - name: beats
    jobs: []

  - name: x-pack
    jobs:
      - elasticsearch-os-compatibility
      - x-pack-elasticsearch
      - x-pack-elasticsearch-periodic

  - name: release
    jobs: []


resources:
  - name: elasticsearch:5.x
    type: git
    source:
      uri: https://github.com/elasticdog/flight-school
      branch: '5.x'

  - name: x-pack-elasticsearch:5.x
    type: git
    source:
      uri: https://github.com/elasticdog/gateway
      branch: '5.x'

  - name: 1h
    type: time
    source:
      interval: 1h


jobs:
  - name: elasticsearch-intake
    plan:
      - get: elasticsearch
        resource: elasticsearch:5.x
        trigger: true
      - task: gradle check
        file: elasticsearch/ci/tasks/build-intake.yml

  - name: elasticsearch-os-compatibility
    plan:
      - get: elasticsearch
        resource: elasticsearch:5.x
        passed: [elasticsearch-intake]
        trigger: true
      - aggregate:
        - task: linux
          file: elasticsearch/ci/tasks/build-linux.yml
        - task: darwin
          file: elasticsearch/ci/tasks/build-linux.yml
        - task: windows
          file: elasticsearch/ci/tasks/build-linux.yml

  - name: elasticsearch-periodic
    plan:
      - get: elasticsearch
        resource: elasticsearch:5.x
        passed: [elasticsearch-intake]
      - get: 1h
        trigger: true
      - task: gradle build
        file: elasticsearch/ci/tasks/build-linux.yml

  - name: x-pack-elasticsearch
    plan:
      - aggregate:
        - get: elasticsearch
          resource: elasticsearch:5.x
          trigger: true
          passed: [elasticsearch-os-compatibility]
        - get: x-pack-elasticsearch
          resource: x-pack-elasticsearch:5.x
          trigger: true
      - task: integration
        file: x-pack-elasticsearch/ci/tasks/build.yml

  - name: x-pack-elasticsearch-periodic
    plan:
      - aggregate:
        - get: elasticsearch
          resource: elasticsearch:5.x
          passed: [x-pack-elasticsearch]
        - get: x-pack-elasticsearch
          resource: x-pack-elasticsearch:5.x
          passed: [x-pack-elasticsearch]
        - get: 1h
          trigger: true
      - task: integration
        file: x-pack-elasticsearch/ci/tasks/build.yml
